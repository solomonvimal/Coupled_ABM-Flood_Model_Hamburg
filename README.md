# Coupled_ABM-Flood_Model_Hamburg
As flood risk is a function of flood hazard and communities' exposure and vulnerability, one way of reducing flood risk is by reducing the vulnerability. Focusing on the physical and economic aspects, measures to reduce vulnerability include elevating houses, retrofitting, dry/wet floodproofing, insurance and subsidies. These measures either prevent flooding or minimise the impact. While measures such as subsidies are offered by authorities or aid groups, the decision to implement most adaptation measures is made at the household level. The factors that affect household adaptation behaviour include flood risk perception, experience with flooding, socioeconomic and geographic factors and reliance on public protection.

We build a coupled agent-based and flood models that comprehensively includes and integrates human and flood attributes to draw new insights for flood risk management (FRM) policy design. We use the protection motivation theory (PMT) (Rogers, 1983) to investigate household-level decision making to adopt mitigation measures against flood threats.

This coupled ABM-Flood model is conceptualised based on the coupled flood-agent-institution modelling framework (CLAIM). CLAIM integrates actors, institutions, the urban environment, hydrologic and hydrodynamic processes and external factors that affect local FRM activities. The framework conceptualizes the complex interaction of floods, humans and their environment as drivers of flood hazard, vulnerability and exposure. A full description of the CLAIM framework can be found in Abebe et al. (2019).

The human subsystem is modelled using the agent-based modelling approach (ABM). As such, it incorporates heterogeneous actors and their actions on and interactions with their environment and flood. It also provides the possibility to analyze the underlying institutions that govern the actions and interactions in managing flood risk by incorporating MAIA (Modelling Agent systems using Institutional Analysis) meta-model (Ghorbani et al., 2013). We use the protection motivation theory (PMT) (Rogers, 1983) to investigate household-level decision making to adopt mitigation measures against flood threats. The flood subsystem is modelled using physically-based, numerical flood modelling software. The ABM is coupled with the flood model dynamically to understand how humans and their environment interact, to experiment the effect of different institutions and to investigate FRM policy options.

The code has five packages: *Collective structure*, *Operational structure*, *Physical structure*, *Aggregate data collector* and *Wilhelmsburg context builder and Global Variables*. The first three packages are based on the MAIA structure – the collective and physical structures create the agent and object classes while the operational structure stores four action situation classes. These classes define the human dynamics (threat and coping appraisals, assessing damage and implementing/abandoning measures). The other two packages are based on the RS architecture. The data collection package implements results collection and creating csv outputs The Wilhelmsburg context builder implements model initialization and the Global Variables class defines and updates agent attributes.

This work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License (https://creativecommons.org/licenses/by-nc-sa/4.0/).
Below, we provide a full description of the model following the ODD (Overview, Design Concepts, Details) protocol (Grimm et al., 2006; Grimm et al. 2010).

## 1.	Purpose
The purpose of the coupled model is to explore human-flood interactions to better manage flood risk. We test the effects of economic incentives, institutional configurations and individual strategies on household flood adaptation behaviour in Wilhelmsburg, a quarter of Hamburg, Germany. The adaptation behaviour is the implementation of or not implementing primary measures (install utilities in higher storeys, flood adapted interior fittings and flood barriers) and a secondary measure (adapted furnishing). The economic incentive we consider in the model is a subsidy from the state authorities. The institutional configuration is designed assuming households implement adaptation measures based on house categories, and their decision can be affected by their social network. The individual strategies are the average number of years households take to transform a coping behaviour into an action (i.e., measure implementation), the average number of consecutive years a household implements an adaptation measure and a decision to implement a secondary measure. The impact of households’ adaptation behaviour on the overall flood risk is measured by the number of households who develop a coping behaviour, the number of households who implemented measures and the contents and building damages mitigated.

## 2.	Entities, state variables and scales
The entities included in the model are household agents, an authority agent and the urban environment. 
-	The household agents are representations of the residents of Wilhelmsburg. These agents live in residential houses. The actions they pursue include appraising threat and coping, implementing adaptation measure, and assessing direct damage. The agent attributes related to threat appraisal are flood experience, reliance on public protection, perception of climate change and source of information about flooding. The attributes related to coping appraisal are direct flood experience, house ownership and household income. If agents decide to implement an adaptation measure, they know which measure to implement based on the institutions identified. The conceptualization excludes businesses, industries, farmlands and other auxiliary buildings due to lack of data.
-	The authority agent represents the relevant municipal and state authorities that have the mandate to manage flood risk in Wilhelmsburg. This agent does not have a spatial representation in the model. The only action of this agent is to provide subsidies to household agents based on the policy lever defined in the experimental setup of the model. We model subsidy in a more abstract sense that if agents receive a subsidy, they implement an adaptation measure assuming that agents are satisfied with the amount they receive.
-	The Wilhelmsburg quarter that is surrounded by a ring of dykes and walls defines the urban environment (see Figure 1). The household and authority agents live and interact in this environment. In our conceptualisation, we focus only on household behaviour to protect their houses. Therefore, the only physical artefact explicitly included in the conceptual model are residential houses, which spatially represent the household agents. They have geographical location represented using polygon features, as illustrated in Figure 1. These polygons are used to compute the area of the houses. Houses also have types, which are classified based on “the type of building, occupancy of the ground floor and the type of facing of the building.” (Ujeyl and Rose, 2015, pp. 1540006–6). This study includes 31 types of houses, which we group into five categories: single-family houses, bungalows, IBA buildings, garden houses, and apartment/high-rise buildings.

A simulation runs for 50 time steps in which one time step represents one year. We set the temporal scale in years considering that it may take longer time to implement some of the adaptation measures. The special extent of the model environment is shown in Figure 1 (a shapefile of polygon features). When there is flooding in a given year, a flood map (an output of the coupled flood model) represented by a raster file of 2m resolution is overlaid to evaluate whether a house is flooded. 

<p align="center"> <img src="https://user-images.githubusercontent.com/13009562/83541889-8518dd80-a4fa-11ea-8609-d6ea6e8b17e4.png" width="592.8" height="422"> </p>
Figure 1. A map of the study area of Wilhelmsburg. The red polygon shows Wilhelmsburg’s coastal protection ring of dykes and walls. The study focuses on residential housings within the protected area. The buildings shown in the map are only those that are part of the model conceptualisation. The inset maps in the right show the map of Germany (bottom) and Hamburg (top). (Source: the base map is an ESRI Topographic Map)

## 3.	Process overview and Scheduling
The model implementation flow chart shown in Figure 2 lays out the processes agents perform at every time step. First, household agents assess if they perceive flood as a threat. If they do, they appraise coping that leads to protection motivation behaviour. Second, if there is the intention to implement a measure, they implement the adaptation measure based on their house category. Lastly, if there is a flood event at a given time step, the house layer is overlaid with a flood map corresponding to the event. Households check the flood depth at their property and assess the building and contents damages. Agents’ attributes are updated if the actions change their states. These processes are performed until the end of the simulation time. 

<p align="center"> <img src="https://user-images.githubusercontent.com/13009562/83546673-56523580-a501-11ea-88ec-3ef86d844799.png" width="478.4" height="806"> </p>
Figure 2. CLAIM model implementation flowchart for the FRM case of Wilhelmsburg. (a) shows the general flow chart. (b) shows how implementing individual adaptation measures is modelled in the ABM while (c) shows how measures abandoning is modelled. The rest of the actions shown in sub-process shapes in (a) (shapes with double-struck vertical edges) will be described in the Submodels section. In (b) and (c), RN is a random number, p_(adaptation,primary) and p_(adaptation,secondary) are the probabilities of adapting primary and secondary measures, respectively, and p_abandoning is the probability of abandoning a primary or a secondary measure.

## 4.	Design Concepts
**Basic principles** - We use the protection motivation theory (PMT) (Rogers, 1983) to investigate household-level decision making to adopt mitigation measures against flood threats. PMT has three parts – sources of information, cognitive mediating processes and coping modes. The sources of information can be environmental such as seeing what happens to others and intrapersonal such as experience to a similar threat. Triggered by the information, the cognitive mediation process includes the threat and coping appraisals. The threat appraisal evaluates the severity of and the vulnerability to the threat against the intrinsic and extrinsic positive reinforcers. The coping appraisal evaluates the effectiveness of an adaptation measure to mitigate or reduce the risk, the ability to implement the measure, and the associated cost to implement the measure. If the threat and coping appraisals are high, households develop a protection motivation that leads to action. The coping modes can be a single act, repeated acts, multiple acts or repeated, multiple acts.

We have modified the original PMT to use it in an FRM and ABM contexts for the specific case of Wilhelmsburg. In the current study, the sources of information influence the threat appraisal only. We assume that if there is a threat and need to implement a coping measure, the agents know the type of measure they implement based on their house categories. In the case of Wilhelmsburg, the threat appraisal is a function of flood experience, reliance on public protection (i.e., the dyke system), climate change perception and source of information. Whereas, coping appraisal is a function of personal flood experience, house ownership, household income, subsidy from the state and social network.

A list of all the assumptions made during model conceptualization is provided in the appendix of the main paper (citation).

**Emergence** – Flood risk levels emerge from the behaviour of household agents such as how they appraise threat and coping, their decision to implement (or not) measures that reduces their vulnerability and the subsidy levers the authority agent devises. 

**Adaptation** – The adaptive behaviour of household agents is adopting (or implementing) primary and secondary measures. Primary measure adoption is based on agents’ perception of flood as a threat and their coping assessment, whereas secondary measure adoption is based on the primary measure adoption. 

**Learning** – We assume that if household agents abandon and then implement measures twice, they will not abandon measures anymore.

**Prediction** - Once agents experience flood, their experience does not fade over the simulation period. This has a consequence on agents threat appraisal.

**Sensing** – Household agents sense if they are flooded (based on the flood maps). They are assumed to know the type of adaptation measure they implement based on their house category. 

**Interaction** – Households agents interact with the authority agent indirectly through the subsidies. In addition, household agents interact directly among each other to implement measures. If certain percentage of household agents implement an adaptation measure, agents who live in the same category of house tend to implement a measure.

**Stochasticity** – A number of agent attributes are assigned randomly during initialization and afterwards. For example, household agents flood experience, perception of climate change, information source, house ownership and household income are initialised randomly (see Initialization below). The last four agent attributes are also updated stochastically based on predefined thresholds. The coping behaviour of agents can be stochastic if it is dependent on their social network attribute (see *Coping appraisal* submodel). The decision of implementing and abandoning adaptation measures are also partially stochastic (see *Household adaptation measure implementation* and *Measures abandoning* submodels).

**Observation** – The risk levels are measured by the cumulative number of household agents that: positively appraised coping, positively appraised coping influenced by their social network, implemented primary measures, abandoned primary measures, implemented secondary measures, abandoned secondary measures, and building and contents damage mitigated. All output data (aggregated over the entire agents) are collected at each time step (see the *Aggregate data collector* package). Agent related outputs are collected in a CSV file.

## 5.	Initialization
The coupled ABM-flood model simulation is initialized with 7859 household agents. Due to the lack of available data, some model factors are parametrised based on our expert estimations. Some, however, are based on literature or census data. For example, since the last major flood occurred in 1962 and only 14% of Wilhelmsburg’s residents are older than the age of 65 (according to the 2011 census ), the flood experience attribute of 86% of the agents is randomly initialized as No. The climate change-related thresholds are based on a study on country level concern about climate change in which 44% Germans are “very or extremely worried”, 42% are “somewhat worried” and the remaining 14% are “not at all or not very worried, or does not think climate change is happening” (NatCen Social Research, 2017). However, the study does not directly relate climate change with flooding. 

According to the 2011 census, in Wilhelmsburg, the share of apartments occupied by the owners was 15% while apartments rented for a residential purpose were 82%. The remaining 3% were vacant. Based on that, in the ABM model, we randomly initialise 15% of the households as owners of the houses they occupy while the remaining 85% as renters, assuming that the 3% vacant apartments can potentially be rented. Finally, since income is considered sensitive information, the data is not readily available. Hence, we randomly initialise 30% of the agents as low-income households and the rest as high-income. The initial (base value) of the model input factors are given in Table 1. In the table, the values of the last seven factors are set in model experimentation (i.e., their values may vary among simulations).

Table 1. List of model input factors and their base values.
<p align="center"> <img src="https://user-images.githubusercontent.com/13009562/83564423-fbc6d280-a51c-11ea-93cb-0a8467d82a9c.png" width="640" height="753"> </p>

## 6.	Input data
The houses of household agents are loaded from a shapefile of building layers (polygon features). The flood model in this study is based on extreme storm surge scenarios and two-dimensional (2D) hydrodynamic models explained in (Naulin et al., 2012; Ujeyl and Rose, 2015). The three storm surge events – Event A, Event B and Event C – used in this study has a peak water level of 8.00 m, 7.25 m and 8.64 m, respectively (Naulin et al., 2012). To assess the flood hazard from the three scenario events, flood models that simulate coastal flooding are implemented. The model is developed using the MIKE21 unstructured grid modelling software (DHI, 2017). The 2D model domain defines the computational mesh and bathymetry, in which the latter is based on a digital terrain model. The surface resistance is expressed using a space-dependent Manning number that is based on the current land use categories. The output of the hydrodynamic model relevant for the current study is the inundation map showing the maximum flood depth in Wilhelmsburg. Further, as houses are represented by polygon features (see Figure 1), the flood depth for a specific house is the maximum of the depths extracted for each vertex of the polygon that defines the house.

## 7.	Submodels
*Threat appraisal* 

The factors that affect household agents perception of flood threat in Wilhelmsburg are their flood experience (*FE*), their reliance on public protection (*R*), mainly the ring of dykes, their perception of future climate change (*CC*) and their source of information (*SoI*). Household agents update the four factors every time step based on the following criteria:
- *FE* is related to whether an agent lives in Wilhelmsburg when a flood event happens, and it has a binary value of Yes and No. The value of *FE* changes only after a flood event as given in Eq 1. We assume that the flood experience does not fade over time. 

<img src="https://user-images.githubusercontent.com/13009562/83941657-70d02b80-a7ed-11ea-9bfa-97981f83b954.png">

- *R* has a value of Low, Medium and High. It is dependent on *FE* and whether an agent has direct flood experience (see Eq 2). The Medium value reflects the uncertain position of agents towards the dyke system if they witness flooding in Wilhelmsburg. The value of *R* does not change unless there is a flood event and agents are flooded. This attribute is initialized based on the agents *FE* status.

<img src="https://user-images.githubusercontent.com/13009562/83941832-c822cb80-a7ee-11ea-83ab-33a17fc4c0ac.png">

- *CC* has a value of Yes, No and Uncertain. The *CC* value of every agent is generated randomly from a uniform distribution, as shown in Eq 3. The value of this attribute may change over the simulation period. Assuming that agents may update their *CC* attribute at least once every *Y_CC* years, there is a probability of *1/Y_CC* at every time step to update the attribute using Eq 3. 

<img src="https://user-images.githubusercontent.com/13009562/83941843-de308c00-a7ee-11ea-9e4f-ce0658c2dd04.png">

- We broadly categorize *SoI* as “information from Authorities,” which informs agents that the dykes will protect everyone and there is no flood threat, and “information from other sources,” which informs agents that there can be a flood threat and agents need to prepare. *SoI* is assigned to agents randomly. Similar to the *CC* attribute, there is a probability of *1/Y_SoI*  to update the *SoI* attribute assuming that agents may update this attribute at least once every *Y_SoI* years.

The flood threat is a function of the four factors and agents assess their perception of flooding as a threat using a rule-based decision tree (see Figure 3). If an agent has no experience of flooding, its reliance on public protection is high, and it perceives no threat of flooding regardless of the other factors. On the other hand, if an agent has low reliance on the dyke system, it perceives flooding as a threat regardless of the other factors. In case an agent’s reliance on public protection is intermediate, its perception of climate change determines the threat appraisal. A concern regarding future impacts of climate change results in a perception of flood threat while no concern leads to no perception of the flood threat. If an agent is uncertain about climate change impacts, its source of information determines the threat appraisal. As some of the attributes of agents may change over time, all agents appraise threat at every time step.

<p align="center"> <img src="https://user-images.githubusercontent.com/13009562/83941956-baba1100-a7ef-11ea-965f-f6c291da2184.png"> </p>
Figure 3. Decision tree for the threat appraisal

*Coping appraisal* 

Coping behaviour is initiated depending on agents’ belief in their ability to implement a measure, agents’ expectation that the measure removes the threat or improves the situation, and the perceived costs of implementation. In our model, coping appraisal is influenced by agents direct flood experience, i.e., if they had personal flood experience (*PFE*), house ownership (*HO*), household income (*HI*), state/government subsidy (*SS*) and the number of measures within agent’s social network (*SN*).
- *PFE* has a value of Yes or No based on agents direct flood experience. This attribute is initialised as No for all agents. The value of PFE changes only when an agent’s house is flooded after an event as given in Eq 4. 

<img src="https://user-images.githubusercontent.com/13009562/83942216-e5a56480-a7f1-11ea-85af-59585ea58796.png">

- *HO* has a value of Own or Rented. Initially, agents are randomly assigned to one of the values. Then, we assume that the house ownership of a percentage of the household agents changes randomly, at every time step. 
- *HI* has a value of Low or High. Similar to the house ownership, we assume that the income of a percentage of the household agents changes randomly, at every time step. It should be noted that this factor affects the agents that implement permanent adaptation measures of installing utilities in higher storeys and flood adapted interior fittings, which are classified as structural measures.
- *SS* has a value of Yes or No. This variable is related to the subsidy institution. In the ABM setup, it is used as a policy lever to test the effect of subsidies on the implementation of structural adaptation measures.
- *SN* has a value of Low or High. As shown in Eq 5, this factor depends on the number of agents that implement a specific type of adaptation measure for a given house category. If the number is greater than a threshold, agents who occupy that same house category will have High *SN* value. Otherwise, *SN* is Low. 

<img src="https://user-images.githubusercontent.com/13009562/83942226-ff46ac00-a7f1-11ea-8b59-0075e8840e02.png">
where, *NA_measureType* is the number of agents that implement a specific measure type depending on the category of house they occupy.
 
Coping is a function of the five factors, and agents appraise their coping using a rule-based decision tree illustrated in Figure 4. For households that implement a structural measure, the full decision tree is evaluated while for those that implement non-structural measures (i.e., temporary measures), shapes and lines in dashed line are not assessed. If household agents have direct flood experience, the conditions that they would not intend to cope and implement a structural measure are if they occupy a rented house and (i) they have high income but have low *SN*, or (ii) they have low income and received no subsidy, or (iii) they have low income and received a subsidy, but have low *SN*. If agents live in their own house, the only condition that they would not intend to cope is if they have low income, received no subsidy and have low *SN*. In all the other cases, agents coping appraisal results in intention to cope. If agents do not have direct flood experience, the only case that they develop a coping behaviour is when the agents own the house they occupy and (i) they have high income and have high *SN*, or (ii) they have low income, have received a subsidy and have high *SN*. In the rest of the cases, household agents do not develop coping behaviour. 

In the case of household agents that implement temporary measures, if the agents have direct flood experience, the only condition that they would not intend to cope is if they occupy a rented house and have low *SN*. If agents do not have direct flood experience, the conditions that they would not intend to cope are: (i) if they occupy a rented house and (ii) if they own the house but have low *SN*. In the rest of the cases, household agents develop coping behaviour.

An important aspect regarding the *SN* factor is that as its value changes for all agents in the same house category and since all the agents may not follow the behaviour of other agents in their social network, we introduce a shared strategy parameter that works in tandem with the *SN*. If agents *SN* factor is High, they develop a coping behaviour when a randomly drawn number from a uniform distribution is less than or equal to the shared strategy parameter. 

<p align="center"> <img src="https://user-images.githubusercontent.com/13009562/83942101-028d6800-a7f1-11ea-96db-36c8229a06af.png"> </p>
Figure 4. Decision tree for the coping appraisal. The shapes and lines in dashed line are related to the income and subsidy factors, and they are executed only when households implement structural measures.

*Household adaptation measure implementation*

Following Erdlenbruch and Bonté (2018), we introduce a delay parameter that affects measures implementation. The delay parameter represents the average number of years agents take to transform a protection motivation behaviour into an action, which is implementing a primary measure. The probability that a motivated individual will adapt at a given year is computed as *p_adaptation,primary=1/(delay parameter)*. We also introduce a secondary measure parameter that determines whether agents implement secondary measures. This parameter is set as a threshold value defined by the modeller’s estimation. As shown in Figure 2 (b), agents consider implementing secondary measures only if they implement primary measures. The assumption is that those agents have already appraised coping positively, and they may have a protection motivation to implement a secondary measure. As stated earlier, only multi-storey house categories implement secondary measures. 

*Damages assessment*

The impacts of a flood event can be estimated by the direct and indirect damages of flooding on tangible and intangible assets. In this study, we measure the flood impact based on the potential direct damages which are caused by the physical contact of floodwater with residential houses. We estimate the building and contents damages using depth-damage curves developed for the 31 types of houses in Wilhelmsburg, as discussed in (Ujeyl and Rose, 2015). The building damages are related to replacement and clean-up costs, whereas the contents damages are related to replacement costs of fixed and dismountable furnishing. Figure 5 shows the depth-damage curves for the different house types.

If household agents implement adaptation measures, the building and contents damages of their house reduce. Based on empirical researches (Kreibich and Thieken, 2009; Poussin et al., 2015), we compute the damages reduced as a percentage reduction of the ones presented in Figure 5. Installing utilities in higher storeys reduces the building damage by 36 while it has no impact on the contents damage reduction. Implementing flood adapted interior fittings reduces both damages by 53%. Implementing adapted furnishing reduces the contents damage by 77% while it has no impact on the building damage reduction. In the case of flood barriers, implementing sandbags and water-tight windows and door sealing reduces only the building damage by 29% whereas implementing flood protection walls reduces the flood depth by a maximum of one meter.

*Measures abandoning*

We also introduce an adaption duration parameter factor that affects measures abandoning, following Erdlenbruch and Bonté (2018). The adaptation duration parameter represents the average number of consecutive years a household agent implements an adaptation measure. It is used to estimate the probability that an agent abandons the measure at a given year. The likelihood that a motivated individual abandons a measure at a given year is computed as *p_abandoning=1/(adaptation duration parameter)*. This parameter affects only agents that implement temporary measures. The minimum adaptation duration would be one year. As shown in Figure 2 (c), we limit the frequency of abandoning a measure by an agent using the abandoning frequency threshold. The assumption is that agents will not abandon a measure any more if they abandon and implement it a certain number of times specified in the threshold. If an agent has implemented a secondary measure, the first option to abandon is that measure. Otherwise, the agent abandons the temporary primary measure. In the latter case, the agent appraises coping once again.

## References
Abebe, Y.A., Ghorbani, A., Nikolic, I., Vojinovic, Z., Sanchez, A., 2019. A coupled flood-agent-institution modelling (CLAIM) framework for urban flood risk management. Environ. Model. Softw. 111, 483–492. https://doi.org/10.1016/j.envsoft.2018.10.015

Ghorbani, A., Bots, P., Dignum, V., Dijkema, G., 2013. MAIA: a Framework for Developing Agent-Based Social Simulations. JASSS 16, 9. https://doi.org/10.18564/jasss.2166

Grimm, V., Berger, U., Bastiansen, F., Eliassen, S., Ginot, V., Giske, J., Goss-Custard, J., Grand, T., Heinz, S.K., Huse, G., Huth, A., Jepsen, J.U., Jørgensen, C., Mooij, W.M., Müller, B., Pe’er, G., Piou, C., Railsback, S.F., Robbins, A.M., Robbins, M.M., Rossmanith, E., Rüger, N., Strand, E., Souissi, S., Stillman, R.A., Vabø, R., Visser, U., DeAngelis, D.L., 2006. A standard protocol for describing individual-based and agent-based models. Ecological Modelling 198, 115–126. https://doi.org/10.1016/j.ecolmodel.2006.04.023

Grimm, V., Berger, U., DeAngelis, D.L., Polhill, J.G, Giske, J., Railsback, S.F., 2010. The ODD protocol: A review and first update. Ecological Modelling 221, 2760–2768. https://doi.org/10.1016/j.ecolmodel.2010.08.019

Rogers, R.W., 1983. Cognitive and physiological process in fear appeals and attitudes changer: A revised theory of protection motivation, in: Cacioppo, J.T., Petty, R.E. (Eds.), Social Psychophysiology: A Sourcebook. Guilford Press, New York, NY, USA, pp. 153–176.

Ujeyl, G., Rose, J., 2015. Estimating Direct and Indirect Damages from Storm Surges: The Case of Hamburg—Wilhelmsburg. Coast. Eng. J. 57, 1540006-1-1540006–26. https://doi.org/10.1142/S0578563415400069
